<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>益智题挑战</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        danger: '#EF4444',
                        dark: '#1F2937',
                        light: '#F3F4F6',
                        types: {
                            math: '#3B82F6',
                            logic: '#EC4899',
                            trivia: '#10B981',
                            word: '#8B5CF6',
                            life: '#F59E0B',
                            fun: '#6366F1',
                            number: '#F97316'
                        }
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            .question-card {
                transition: all 0.5s ease;
            }
            .question-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            }
            .scale-in {
                animation: scaleIn 0.5s ease forwards;
            }
            @keyframes scaleIn {
                0% { transform: scale(0.95); opacity: 0; }
                100% { transform: scale(1); opacity: 1; }
            }
            .fade-in {
                animation: fadeIn 0.5s ease forwards;
            }
            @keyframes fadeIn {
                0% { opacity: 0; }
                100% { opacity: 1; }
            }
        }
    </style>
    <style>
        /* 针对移动设备的额外优化 */
        @media (max-width: 640px) {
            html {
                font-size: 14px;
            }
            
            .container {
                padding-left: 0.75rem !important;
                padding-right: 0.75rem !important;
            }
            
            #game-container {
                padding: 1.5rem !important;
            }
            
            .btn-mobile {
                padding: 0.75rem 1.5rem !important;
                font-size: 1rem !important;
            }
            
            #question {
                font-size: 1.75rem !important;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-purple-50 min-h-screen font-inter text-dark">
    <div class="container mx-auto px-4 py-6 max-w-4xl">
        <!-- 游戏标题 -->
        <header class="text-center mb-6">
            <h1 class="text-[clamp(1.5rem,4vw,2.5rem)] font-bold text-primary mb-2 text-shadow">益智题挑战</h1>
            <p class="text-gray-600">测试你的综合能力，挑战无限AI生成的益智题目！</p>
        </header>

        <!-- 当前玩家显示 -->
        <div id="current-player-container" class="bg-white rounded-xl shadow-lg p-3 mb-6 flex items-center justify-center hidden">
            <i class="fa fa-user-circle text-primary text-xl mr-2"></i>
            <p class="text-gray-700">当前玩家: <span id="current-player-name" class="font-bold text-primary">未选择</span></p>
        </div>

        <!-- 游戏状态 -->
        <div class="flex flex-wrap gap-3 justify-center mb-6">
            <div class="bg-white rounded-xl shadow-lg p-3 w-[45%] flex items-center justify-center card-hover">
                <i class="fa fa-trophy text-accent text-xl mr-2"></i>
                <div>
                    <p class="text-gray-500 text-xs">得分</p>
                    <p id="score" class="text-xl font-bold">0</p>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-3 w-[45%] flex items-center justify-center card-hover">
                <i class="fa fa-clock-o text-danger text-xl mr-2"></i>
                <div>
                    <p class="text-gray-500 text-xs">剩余时间</p>
                    <p id="timer" class="text-xl font-bold">60</p>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-3 w-[45%] flex items-center justify-center card-hover">
                <i class="fa fa-signal text-secondary text-xl mr-2"></i>
                <div>
                    <p class="text-gray-500 text-xs">难度</p>
                    <p id="difficulty" class="text-xl font-bold">简单</p>
                </div>
            </div>
            
            <div id="question-type-indicator" class="bg-white rounded-xl shadow-lg p-3 w-[45%] flex items-center justify-center card-hover">
                <i id="type-icon" class="fa fa-calculator text-types-math text-xl mr-2"></i>
                <div>
                    <p class="text-gray-500 text-xs">题目类型</p>
                    <p id="question-type" class="text-xl font-bold">数学运算</p>
                </div>
            </div>
        </div>

        <!-- 游戏区域 -->
        <div id="game-container" class="bg-white rounded-2xl shadow-xl p-6 mb-6 transform transition-all duration-500 question-card">
            <div id="question-container" class="text-center mb-6">
                <p class="text-gray-600 mb-2">当前题目</p>
                <p id="question" class="text-2xl md:text-3xl font-bold mb-4">3 + 5 = ?</p>
                
                <div id="options-container" class="flex flex-col sm:flex-row gap-3 justify-center mb-6">
                    <button id="option1" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50 shadow-lg btn-mobile">8</button>
                    <button id="option2" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50 shadow-lg btn-mobile">9</button>
                    <button id="option3" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50 shadow-lg btn-mobile">7</button>
                </div>
                
                <div id="input-answer-container" class="hidden mb-6">
                    <input type="text" id="input-answer" placeholder="输入你的答案..." class="w-full max-w-md mx-auto px-4 py-2 rounded-lg border-2 border-gray-300 focus:border-primary focus:ring focus:ring-primary/20 outline-none transition-all">
                    <button id="submit-answer" class="mt-3 bg-primary hover:bg-primary/90 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50 shadow-lg btn-mobile">
                        提交答案
                    </button>
                </div>
            </div>
            
            <div id="feedback" class="text-center h-8 mb-3"></div>
            
            <div id="progress-container" class="h-3 w-full bg-gray-200 rounded-full overflow-hidden">
                <div id="progress-bar" class="h-full bg-gradient-to-r from-secondary to-primary transition-all duration-300" style="width: 100%"></div>
            </div>
        </div>

        <!-- 游戏控制 -->
        <div class="flex flex-wrap gap-3 justify-center mb-6">
            <button id="start-btn" class="bg-secondary hover:bg-secondary/90 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-secondary/50 shadow-lg btn-mobile">
                <i class="fa fa-play mr-2"></i>开始游戏
            </button>
            <button id="restart-btn" class="bg-accent hover:bg-accent/90 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-accent/50 shadow-lg hidden btn-mobile">
                <i class="fa fa-refresh mr-2"></i>重新开始
            </button>
            <button id="settings-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-500/50 shadow-lg btn-mobile">
                <i class="fa fa-cog mr-2"></i>设置
            </button>
            <button id="highscores-btn" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50 shadow-lg btn-mobile">
                <i class="fa fa-star mr-2"></i>高分榜
            </button>
            <button id="change-player-btn" class="bg-accent hover:bg-accent/90 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-accent/50 shadow-lg btn-mobile hidden">
                <i class="fa fa-user mr-2"></i>切换玩家
            </button>
        </div>

        <!-- 玩家选择模态框 -->
        <div id="player-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl p-5 max-w-md w-full mx-3 transform transition-all duration-300 scale-95 opacity-0" id="player-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-primary">选择或创建玩家</h2>
                    <button id="close-player-modal" class="text-gray-500 hover:text-gray-700 focus:outline-none">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="mb-4">
                    <input type="text" id="new-player-name" placeholder="输入新玩家名称..." class="w-full px-4 py-2 rounded-lg border-2 border-gray-300 focus:border-primary focus:ring focus:ring-primary/20 outline-none transition-all mb-4">
                    <button id="add-player-btn" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-2 px-5 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50 shadow-lg">
                        添加新玩家
                    </button>
                </div>
                
                <div class="mb-4">
                    <h3 class="text-gray-700 mb-2 font-medium">已有玩家</h3>
                    <div id="players-list" class="max-h-40 overflow-y-auto space-y-2">
                        <!-- 玩家列表将动态生成 -->
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button id="select-player-btn" class="bg-secondary hover:bg-secondary/90 text-white font-bold py-2 px-5 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-secondary/50 shadow-lg" disabled>
                        选择玩家
                    </button>
                </div>
            </div>
        </div>

        <!-- 高分榜模态框 -->
        <div id="highscores-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl p-5 max-w-md w-full mx-3 transform transition-all duration-300 scale-95 opacity-0" id="highscores-modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-primary">高分榜</h2>
                    <button id="close-highscores" class="text-gray-500 hover:text-gray-700 focus:outline-none">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-gray-700 font-medium">所有玩家排名</h3>
                        <select id="highscores-filter" class="p-1 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                            <option value="all">全部</option>
                            <option value="current">当前玩家</option>
                        </select>
                    </div>
                    
                    <div id="highscores-list" class="space-y-2 max-h-80 overflow-y-auto">
                        <!-- 高分榜将动态生成 -->
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button id="close-highscores-btn" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-5 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50 shadow-lg">
                        关闭
                    </button>
                </div>
            </div>
        </div>

        <!-- 设置模态框 -->
        <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl p-5 max-w-md w-full mx-3 transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-primary">游戏设置</h2>
                    <button id="close-settings" class="text-gray-500 hover:text-gray-700 focus:outline-none">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2 font-medium">题目类型</label>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                        <label class="flex items-center p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <input type="checkbox" name="question-types" value="math" checked class="mr-2 h-4 w-4 text-types-math focus:ring-types-math rounded">
                            <span class="flex items-center">
                                <i class="fa fa-calculator text-types-math mr-2"></i>
                                数学运算
                            </span>
                        </label>
                        <label class="flex items-center p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <input type="checkbox" name="question-types" value="logic" checked class="mr-2 h-4 w-4 text-types-logic focus:ring-types-logic rounded">
                            <span class="flex items-center">
                                <i class="fa fa-puzzle-piece text-types-logic mr-2"></i>
                                逻辑思维
                            </span>
                        </label>
                        <label class="flex items-center p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <input type="checkbox" name="question-types" value="trivia" checked class="mr-2 h-4 w-4 text-types-trivia focus:ring-types-trivia rounded">
                            <span class="flex items-center">
                                <i class="fa fa-lightbulb-o text-types-trivia mr-2"></i>
                                脑筋急转弯
                            </span>
                        </label>
                        <label class="flex items-center p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <input type="checkbox" name="question-types" value="word" checked class="mr-2 h-4 w-4 text-types-word focus:ring-types-word rounded">
                            <span class="flex items-center">
                                <i class="fa fa-book text-types-word mr-2"></i>
                                文字理解
                            </span>
                        </label>
                        <label class="flex items-center p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <input type="checkbox" name="question-types" value="life" checked class="mr-2 h-4 w-4 text-types-life focus:ring-types-life rounded">
                            <span class="flex items-center">
                                <i class="fa fa-home text-types-life mr-2"></i>
                                生活常识
                            </span>
                        </label>
                        <label class="flex items-center p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <input type="checkbox" name="question-types" value="fun" checked class="mr-2 h-4 w-4 text-types-fun focus:ring-types-fun rounded">
                            <span class="flex items-center">
                                <i class="fa fa-smile-o text-types-fun mr-2"></i>
                                趣味推理
                            </span>
                        </label>
                        <label class="flex items-center p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <input type="checkbox" name="question-types" value="number" checked class="mr-2 h-4 w-4 text-types-number focus:ring-types-number rounded">
                            <span class="flex items-center">
                                <i class="fa fa-superscript text-types-number mr-2"></i>
                                数字推理
                            </span>
                        </label>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label for="time-limit" class="block text-gray-700 mb-2 font-medium">每题时间限制 (秒)</label>
                    <input type="range" id="time-limit" min="5" max="120" value="60" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                    <div class="flex justify-between text-sm text-gray-500 mt-1">
                        <span>5秒</span>
                        <span id="time-value">60秒</span>
                        <span>120秒</span>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label for="difficulty-setting" class="block text-gray-700 mb-2 font-medium">难度级别</label>
                    <select id="difficulty-setting" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                        <option value="easy">简单</option>
                        <option value="medium">中等</option>
                        <option value="hard">困难</option>
                    </select>
                </div>
                
                <div class="flex justify-end">
                    <button id="save-settings" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-5 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50 shadow-lg">
                        保存设置
                    </button>
                </div>
            </div>
        </div>

        <!-- 游戏结束模态框 -->
        <div id="game-over-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl p-5 max-w-md w-full mx-3 transform transition-all duration-300 scale-95 opacity-0" id="game-over-content">
                <div class="text-center mb-4">
                    <div class="inline-flex items-center justify-center w-14 h-14 rounded-full bg-accent/20 mb-3">
                        <i class="fa fa-trophy text-accent text-2xl"></i>
                    </div>
                    <h2 class="text-xl font-bold text-primary mb-2">游戏结束!</h2>
                    <p class="text-gray-600">你的表现很棒!</p>
                </div>
                
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2 p-2 bg-gray-50 rounded-lg">
                        <span class="text-gray-700">最终得分</span>
                        <span id="final-score" class="text-xl font-bold text-primary">0</span>
                    </div>
                    <div class="flex justify-between items-center mb-2 p-2 bg-gray-50 rounded-lg">
                        <span class="text-gray-700">答对题目</span>
                        <span id="correct-answers" class="text-lg font-bold text-secondary">0</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded-lg">
                        <span class="text-gray-700">答错题目</span>
                        <span id="wrong-answers" class="text-lg font-bold text-danger">0</span>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div id="highscore-indicator" class="bg-accent/10 text-accent p-3 rounded-lg text-center hidden">
                        <i class="fa fa-star mr-1"></i>
                        <span id="highscore-message">新的个人最佳成绩!</span>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-3 justify-center">
                    <button id="play-again" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-5 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50 shadow-lg">
                        <i class="fa fa-refresh mr-2"></i>再玩一次
                    </button>
                    <button id="share-result" class="bg-accent hover:bg-accent/90 text-white font-bold py-2 px-5 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-accent/50 shadow-lg">
                        <i class="fa fa-share-alt mr-2"></i>分享结果
                    </button>
                </div>
            </div>
        </div>

        <!-- 页脚 -->
        <footer class="text-center text-gray-500 mt-8 text-sm">
            <p>© 2025 益智题挑战 | 训练你的大脑</p>
        </footer>
    </div>

    <script>
        // 游戏状态
        const gameState = {
            score: 0,
            timeLeft: 60,
            timerInterval: null,
            isPlaying: false,
            currentQuestion: null,
            correctAnswers: 0,
            wrongAnswers: 0,
            difficulty: 'easy',
            questionTypes: ['math', 'logic', 'trivia', 'word', 'life', 'fun', 'number'],
            timeLimit: 60,
            questions: null, // 从JSON加载的题库
            usedQuestions: {}, // 记录已使用的题目索引，避免重复
            currentPlayer: null, // 当前玩家
            players: [], // 所有玩家
            highscores: [] // 高分记录
        };

        // 题目类型配置
        const questionTypeConfig = {
            math: {
                name: '数学运算',
                icon: 'fa-calculator',
                color: 'text-types-math',
                buttonColor: 'bg-types-math'
            },
            logic: {
                name: '逻辑思维',
                icon: 'fa-puzzle-piece',
                color: 'text-types-logic',
                buttonColor: 'bg-types-logic'
            },
            trivia: {
                name: '脑筋急转弯',
                icon: 'fa-lightbulb-o',
                color: 'text-types-trivia',
                buttonColor: 'bg-types-trivia'
            },
            word: {
                name: '文字理解',
                icon: 'fa-book',
                color: 'text-types-word',
                buttonColor: 'bg-types-word'
            },
            life: {
                name: '生活常识',
                icon: 'fa-home',
                color: 'text-types-life',
                buttonColor: 'bg-types-life'
            },
            fun: {
                name: '趣味推理',
                icon: 'fa-smile-o',
                color: 'text-types-fun',
                buttonColor: 'bg-types-fun'
            },
            number: {
                name: '数字推理',
                icon: 'fa-superscript',
                color: 'text-types-number',
                buttonColor: 'bg-types-number'
            }
        };

        // DOM 元素
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const closeSettingsBtn = document.getElementById('close-settings');
        const saveSettingsBtn = document.getElementById('save-settings');
        const playAgainBtn = document.getElementById('play-again');
        const shareResultBtn = document.getElementById('share-result');
        const scoreDisplay = document.getElementById('score');
        const timerDisplay = document.getElementById('timer');
        const difficultyDisplay = document.getElementById('difficulty');
        const questionDisplay = document.getElementById('question');
        const optionButtons = [
            document.getElementById('option1'),
            document.getElementById('option2'),
            document.getElementById('option3')
        ];
        const optionsContainer = document.getElementById('options-container');
        const inputAnswerContainer = document.getElementById('input-answer-container');
        const inputAnswer = document.getElementById('input-answer');
        const submitAnswer = document.getElementById('submit-answer');
        const feedbackDisplay = document.getElementById('feedback');
        const progressBar = document.getElementById('progress-bar');
        const gameContainer = document.getElementById('game-container');
        const settingsModal = document.getElementById('settings-modal');
        const modalContent = document.getElementById('modal-content');
        const gameOverModal = document.getElementById('game-over-modal');
        const gameOverContent = document.getElementById('game-over-content');
        const finalScoreDisplay = document.getElementById('final-score');
        const correctAnswersDisplay = document.getElementById('correct-answers');
        const wrongAnswersDisplay = document.getElementById('wrong-answers');
        const timeLimitSlider = document.getElementById('time-limit');
        const timeValueDisplay = document.getElementById('time-value');
        const difficultySetting = document.getElementById('difficulty-setting');
        const questionTypeCheckboxes = document.querySelectorAll('input[name="question-types"]');
        const questionTypeIndicator = document.getElementById('question-type-indicator');
        const questionTypeDisplay = document.getElementById('question-type');
        const typeIcon = document.getElementById('type-icon');
        const highscoresBtn = document.getElementById('highscores-btn');
        const highscoresModal = document.getElementById('highscores-modal');
        const highscoresModalContent = document.getElementById('highscores-modal-content');
        const closeHighscoresBtn = document.getElementById('close-highscores-btn');
        const closeHighscoresX = document.getElementById('close-highscores');
        const highscoresList = document.getElementById('highscores-list');
        const highscoresFilter = document.getElementById('highscores-filter');
        const playerModal = document.getElementById('player-modal');
        const playerModalContent = document.getElementById('player-modal-content');
        const closePlayerModal = document.getElementById('close-player-modal');
        const newPlayerName = document.getElementById('new-player-name');
        const addPlayerBtn = document.getElementById('add-player-btn');
        const playersList = document.getElementById('players-list');
        const selectPlayerBtn = document.getElementById('select-player-btn');
        const currentPlayerContainer = document.getElementById('current-player-container');
        const currentPlayerName = document.getElementById('current-player-name');
        const changePlayerBtn = document.getElementById('change-player-btn');
        const highscoreIndicator = document.getElementById('highscore-indicator');
        const highscoreMessage = document.getElementById('highscore-message');

        // 初始化事件监听器
        function initEventListeners() {
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', restartGame);
            settingsBtn.addEventListener('click', openSettings);
            closeSettingsBtn.addEventListener('click', closeSettings);
            saveSettingsBtn.addEventListener('click', saveSettings);
            playAgainBtn.addEventListener('click', restartGame);
            shareResultBtn.addEventListener('click', shareResult);
            timeLimitSlider.addEventListener('input', updateTimeValue);
            optionButtons.forEach(button => button.addEventListener('click', checkAnswer));
            submitAnswer.addEventListener('click', checkInputAnswer);
            highscoresBtn.addEventListener('click', openHighscores);
            closeHighscoresBtn.addEventListener('click', closeHighscores);
            closeHighscoresX.addEventListener('click', closeHighscores);
            highscoresFilter.addEventListener('change', updateHighscoresList);
            closePlayerModal.addEventListener('click', closePlayerSelection);
            addPlayerBtn.addEventListener('click', addNewPlayer);
            changePlayerBtn.addEventListener('click', openPlayerSelection);
            
            // 允许按Enter键提交输入答案
            inputAnswer.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkInputAnswer();
                }
            });
            
            // 模态框动画
            settingsModal.addEventListener('click', (e) => {
                if (e.target === settingsModal) closeSettings();
            });
            
            gameOverModal.addEventListener('click', (e) => {
                if (e.target === gameOverModal) closeGameOverModal();
            });
            
            highscoresModal.addEventListener('click', (e) => {
                if (e.target === highscoresModal) closeHighscores();
            });
            
            playerModal.addEventListener('click', (e) => {
                if (e.target === playerModal) closePlayerSelection();
            });
        }

        // 加载玩家数据
        function loadPlayerData() {
            // 从本地存储加载玩家数据
            const savedPlayers = localStorage.getItem('quizPlayers');
            const savedHighscores = localStorage.getItem('quizHighscores');
            
            if (savedPlayers) {
                gameState.players = JSON.parse(savedPlayers);
            }
            
            if (savedHighscores) {
                gameState.highscores = JSON.parse(savedHighscores);
            }
            
            // 如果没有玩家，创建一个默认玩家
            if (gameState.players.length === 0) {
                addNewPlayer('默认玩家', true);
            }
            
            // 更新玩家列表UI
            updatePlayersList();
        }

        // 添加新玩家
        function addNewPlayer(name = null, skipValidation = false) {
            let playerName = name || newPlayerName.value.trim();
            
            if (!skipValidation) {
                if (!playerName) {
                    alert('请输入玩家名称');
                    return;
                }
                
                // 检查玩家是否已存在
                const playerExists = gameState.players.some(p => p.name.toLowerCase() === playerName.toLowerCase());
                if (playerExists) {
                    alert('该玩家名称已存在');
                    return;
                }
            }
            
            const newPlayer = {
                id: Date.now().toString(),
                name: playerName
            };
            
            gameState.players.push(newPlayer);
            
            // 保存到本地存储
            savePlayerData();
            
            // 更新UI
            updatePlayersList();
            
            // 清空输入框
            newPlayerName.value = '';
            
            // 自动选择新添加的玩家
            selectPlayer(newPlayer.id);
        }

        // 更新玩家列表
        function updatePlayersList() {
            playersList.innerHTML = '';
            
            gameState.players.forEach(player => {
                const playerElement = document.createElement('div');
                playerElement.className = `flex items-center p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer ${gameState.currentPlayer?.id === player.id ? 'bg-primary/10 border-l-4 border-primary' : ''}`;
                playerElement.innerHTML = `
                    <i class="fa fa-user-circle text-primary mr-2"></i>
                    <span>${player.name}</span>
                `;
                playerElement.addEventListener('click', () => selectPlayer(player.id));
                
                playersList.appendChild(playerElement);
            });
            
            // 更新选择按钮状态
            updateSelectPlayerButton();
        }

        // 选择玩家
        function selectPlayer(playerId) {
            const player = gameState.players.find(p => p.id === playerId);
            if (player) {
                gameState.currentPlayer = player;
                
                // 更新UI
                currentPlayerName.textContent = player.name;
                currentPlayerContainer.classList.remove('hidden');
                changePlayerBtn.classList.remove('hidden');
                
                // 高亮选中的玩家
                document.querySelectorAll('#players-list > div').forEach(el => {
                    el.classList.remove('bg-primary/10', 'border-l-4', 'border-primary');
                });
                
                const selectedElement = Array.from(document.querySelectorAll('#players-list > div'))
                    .find(el => el.textContent.includes(player.name));
                
                if (selectedElement) {
                    selectedElement.classList.add('bg-primary/10', 'border-l-4', 'border-primary');
                }
                
                updateSelectPlayerButton();
            }
        }

        // 更新选择玩家按钮状态
        function updateSelectPlayerButton() {
            selectPlayerBtn.disabled = !gameState.currentPlayer;
        }

        // 保存玩家数据
        function savePlayerData() {
            localStorage.setItem('quizPlayers', JSON.stringify(gameState.players));
            localStorage.setItem('quizHighscores', JSON.stringify(gameState.highscores));
        }

        // 打开玩家选择模态框
        function openPlayerSelection() {
            playerModal.classList.remove('hidden');
            setTimeout(() => {
                playerModalContent.classList.remove('scale-95', 'opacity-0');
                playerModalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        // 关闭玩家选择模态框
        function closePlayerSelection() {
            playerModalContent.classList.remove('scale-100', 'opacity-100');
            playerModalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                playerModal.classList.add('hidden');
            }, 300);
        }

        // 保存分数
        function saveScore() {
            if (!gameState.currentPlayer) return;
            
            const newScore = {
                id: Date.now().toString(),
                playerId: gameState.currentPlayer.id,
                playerName: gameState.currentPlayer.name,
                score: gameState.score,
                correctAnswers: gameState.correctAnswers,
                wrongAnswers: gameState.wrongAnswers,
                difficulty: gameState.difficulty,
                date: new Date().toISOString()
            };
            
            gameState.highscores.push(newScore);
            
            // 只保留每个玩家的前10个最高分
            const topScoresPerPlayer = {};
            gameState.highscores.forEach(score => {
                if (!topScoresPerPlayer[score.playerId]) {
                    topScoresPerPlayer[score.playerId] = [];
                }
                topScoresPerPlayer[score.playerId].push(score);
                
                // 排序并保留前10名
                topScoresPerPlayer[score.playerId].sort((a, b) => b.score - a.score);
                if (topScoresPerPlayer[score.playerId].length > 10) {
                    topScoresPerPlayer[score.playerId] = topScoresPerPlayer[score.playerId].slice(0, 10);
                }
            });
            
            // 重建高分列表
            gameState.highscores = [];
            Object.values(topScoresPerPlayer).forEach(scores => {
                gameState.highscores.push(...scores);
            });
            
            // 保存到本地存储
            savePlayerData();
            
            // 检查是否是个人最佳成绩
            return isPersonalBest(newScore);
        }

        // 检查是否是个人最佳成绩
        function isPersonalBest(newScore) {
            const playerScores = gameState.highscores
                .filter(s => s.playerId === newScore.playerId)
                .sort((a, b) => b.score - a.score);
                
            return playerScores.length === 0 || playerScores[0].id === newScore.id;
        }

        // 打开高分榜
        function openHighscores() {
            updateHighscoresList();
            
            highscoresModal.classList.remove('hidden');
            setTimeout(() => {
                highscoresModalContent.classList.remove('scale-95', 'opacity-0');
                highscoresModalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        // 关闭高分榜
        function closeHighscores() {
            highscoresModalContent.classList.remove('scale-100', 'opacity-100');
            highscoresModalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                highscoresModal.classList.add('hidden');
            }, 300);
        }

        // 更新高分榜列表
        function updateHighscoresList() {
            highscoresList.innerHTML = '';
            
            let filteredScores = [...gameState.highscores];
            
            // 应用过滤器
            if (highscoresFilter.value === 'current' && gameState.currentPlayer) {
                filteredScores = filteredScores.filter(s => s.playerId === gameState.currentPlayer.id);
            }
            
            // 按分数排序
            filteredScores.sort((a, b) => b.score - a.score);
            
            // 只显示前20名
            const topScores = filteredScores.slice(0, 20);
            
            if (topScores.length === 0) {
                highscoresList.innerHTML = '<div class="text-center text-gray-500 py-4">暂无分数记录</div>';
                return;
            }
            
            topScores.forEach((score, index) => {
                const scoreElement = document.createElement('div');
                const isCurrentPlayer = gameState.currentPlayer && score.playerId === gameState.currentPlayer.id;
                
                scoreElement.className = `flex justify-between items-center p-2 rounded-lg ${isCurrentPlayer ? 'bg-primary/10' : index < 3 ? 'bg-accent/5' : 'bg-gray-50'}`;
                
                // 格式化日期
                const date = new Date(score.date);
                const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                
                let medalIcon = '';
                if (index === 0) medalIcon = '<i class="fa fa-trophy text-accent mr-2"></i>';
                else if (index === 1) medalIcon = '<i class="fa fa-trophy text-gray-400 mr-2"></i>';
                else if (index === 2) medalIcon = '<i class="fa fa-trophy text-amber-700 mr-2"></i>';
                
                scoreElement.innerHTML = `
                    <div class="flex items-center">
                        <span class="w-6 text-center font-bold ${index < 3 ? 'text-accent' : 'text-gray-500'}">${index + 1}</span>
                        ${medalIcon}
                        <span class="font-medium ${isCurrentPlayer ? 'text-primary font-bold' : ''}">${score.playerName}</span>
                    </div>
                    <div class="text-right">
                        <span class="font-bold text-primary">${score.score}</span>
                        <span class="text-xs text-gray-500 ml-2">${formattedDate}</span>
                    </div>
                `;
                
                highscoresList.appendChild(scoreElement);
            });
        }

        // 加载题库
        async function loadQuestions() {
            try {
                const response = await fetch('questions.json');
                if (!response.ok) {
                    throw new Error('Failed to load questions');
                }
                gameState.questions = await response.json();
                console.log('题库加载成功');
            } catch (error) {
                console.error('加载题库时出错:', error);
                // 加载失败时使用备用题目
                gameState.questions = getFallbackQuestions();
            }
        }

        // 更新时间显示
        function updateTimeValue() {
            timeValueDisplay.textContent = `${timeLimitSlider.value}秒`;
        }

        // 开始游戏
        function startGame() {
            // 如果没有选择玩家，先显示玩家选择模态框
            if (!gameState.currentPlayer) {
                openPlayerSelection();
                return;
            }
            
            if (!gameState.questions) {
                alert('正在加载题库，请稍候重试');
                return;
            }
            
            gameState.isPlaying = true;
            startBtn.classList.add('hidden');
            restartBtn.classList.remove('hidden');
            gameState.score = 0;
            gameState.correctAnswers = 0;
            gameState.wrongAnswers = 0;
            gameState.usedQuestions = {}; // 重置已使用的题目
            updateScore();
            generateQuestion();
            startTimer();
            
            // 添加游戏开始动画
            gameContainer.classList.add('animate-pulse');
            setTimeout(() => {
                gameContainer.classList.remove('animate-pulse');
            }, 1000);
        }

        // 重新开始游戏
        function restartGame() {
            clearInterval(gameState.timerInterval);
            gameState.timeLeft = gameState.timeLimit;
            timerDisplay.textContent = gameState.timeLeft;
            progressBar.style.width = '100%';
            closeGameOverModal();
            startGame();
        }

        // 打开设置
        function openSettings() {
            // 填充当前设置
            difficultySetting.value = gameState.difficulty;
            timeLimitSlider.value = gameState.timeLimit;
            updateTimeValue();
            
            // 勾选当前问题类型
            questionTypeCheckboxes.forEach(checkbox => {
                checkbox.checked = gameState.questionTypes.includes(checkbox.value);
            });
            
            settingsModal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        // 关闭设置
        function closeSettings() {
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                settingsModal.classList.add('hidden');
            }, 300);
        }

        // 保存设置
        function saveSettings() {
            // 更新难度
            gameState.difficulty = difficultySetting.value;
            difficultyDisplay.textContent = gameState.difficulty.charAt(0).toUpperCase() + gameState.difficulty.slice(1);
            
            // 更新时间限制
            gameState.timeLimit = parseInt(timeLimitSlider.value);
            gameState.timeLeft = gameState.timeLimit;
            timerDisplay.textContent = gameState.timeLeft;
            
            // 更新问题类型
            gameState.questionTypes = Array.from(questionTypeCheckboxes)
                .filter(checkbox => checkbox.checked)
                .map(checkbox => checkbox.value);
            
            // 如果没有选择任何问题类型，默认选择数学运算
            if (gameState.questionTypes.length === 0) {
                gameState.questionTypes = ['math'];
                document.querySelector('input[name="question-types"][value="math"]').checked = true;
            }
            
            closeSettings();
        }

        // 分享结果
        function shareResult() {
            // 模拟分享功能
            if (navigator.share) {
                navigator.share({
                    title: '益智题挑战',
                    text: `${gameState.currentPlayer.name}在益智题挑战中得了${gameState.score}分！你也来试试吧！`,
                    url: window.location.href
                })
                .catch(error => console.log('分享失败:', error));
            } else {
                alert(`${gameState.currentPlayer.name}的得分: ${gameState.score}\n\n复制此链接分享: ${window.location.href}`);
            }
        }

        // 关闭游戏结束模态框
        function closeGameOverModal() {
            gameOverContent.classList.remove('scale-100', 'opacity-100');
            gameOverContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                gameOverModal.classList.add('hidden');
            }, 300);
        }

        // 开始计时器
        function startTimer() {
            clearInterval(gameState.timerInterval);
            gameState.timeLeft = gameState.timeLimit;
            timerDisplay.textContent = gameState.timeLeft;
            progressBar.style.width = '100%';
            
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft--;
                timerDisplay.textContent = gameState.timeLeft;
                const percentage = (gameState.timeLeft / gameState.timeLimit) * 100;
                progressBar.style.width = `${percentage}%`;
                
                // 时间快用完时的视觉提示
                if (gameState.timeLeft <= 10) {
                    timerDisplay.classList.add('text-danger');
                    timerDisplay.classList.add('animate-pulse');
                } else {
                    timerDisplay.classList.remove('text-danger');
                    timerDisplay.classList.remove('animate-pulse');
                }
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(gameState.timerInterval);
                    handleWrongAnswer();
                }
            }, 1000);
        }

        // 更新分数显示
        function updateScore() {
            scoreDisplay.textContent = gameState.score;
        }

        // 生成问题
        function generateQuestion() {
            // 随机选择问题类型
            const questionType = gameState.questionTypes[Math.floor(Math.random() * gameState.questionTypes.length)];
            
            // 获取该类型的题目
            const questionsOfType = gameState.questions[questionType] || [];
            
            if (questionsOfType.length === 0) {
                // 如果该类型没有题目，使用默认题目
                const defaultQuestion = {
                    question: "默认问题",
                    answer: "默认答案",
                    options: ["选项1", "选项2", "选项3"]
                };
                
                updateQuestionUI(defaultQuestion, questionType);
                return;
            }
            
            // 确保不重复使用题目
            let availableQuestions = questionsOfType;
            if (gameState.usedQuestions[questionType]) {
                availableQuestions = questionsOfType.filter((_, index) => 
                    !gameState.usedQuestions[questionType].includes(index)
                );
                
                // 如果所有题目都用过了，重置已使用的题目列表
                if (availableQuestions.length === 0) {
                    gameState.usedQuestions[questionType] = [];
                    availableQuestions = questionsOfType;
                }
            } else {
                gameState.usedQuestions[questionType] = [];
            }
            
            // 随机选择一个题目
            const randomIndex = Math.floor(Math.random() * availableQuestions.length);
            const originalIndex = questionsOfType.indexOf(availableQuestions[randomIndex]);
            gameState.usedQuestions[questionType].push(originalIndex);
            
            const questionData = availableQuestions[randomIndex];
            
            // 更新UI
            updateQuestionUI(questionData, questionType);
        }

        // 更新问题UI
        function updateQuestionUI(questionData, questionType) {
            // 更新问题类型指示器
            updateQuestionTypeIndicator(questionType);
            
            // 保存当前问题
            gameState.currentQuestion = {
                ...questionData,
                type: questionType
            };
            
            // 更新UI
            questionDisplay.textContent = questionData.question;
            
            // 根据问题类型决定显示选项还是输入框
            if (questionData.options) {
                // 随机排序选项
                const shuffledOptions = [...questionData.options].sort(() => Math.random() - 0.5);
                
                // 更新选项按钮
                optionButtons.forEach((button, index) => {
                    button.textContent = shuffledOptions[index];
                    button.disabled = false;
                    button.classList.remove('bg-secondary', 'bg-danger', 'opacity-70');
                    button.classList.remove(...Object.values(questionTypeConfig).map(config => config.buttonColor));
                    button.classList.add(questionTypeConfig[questionType].buttonColor);
                });
                
                // 显示选项容器，隐藏输入容器
                optionsContainer.classList.remove('hidden');
                inputAnswerContainer.classList.add('hidden');
            } else {
                // 隐藏选项容器，显示输入容器
                optionsContainer.classList.add('hidden');
                inputAnswerContainer.classList.remove('hidden');
                inputAnswer.value = '';
                inputAnswer.disabled = false;
                submitAnswer.disabled = false;
                inputAnswer.focus();
            }
            
            // 添加问题出现动画
            gameContainer.classList.add('scale-in');
            setTimeout(() => {
                gameContainer.classList.remove('scale-in');
            }, 500);
            
            // 重置反馈
            feedbackDisplay.textContent = '';
        }

        // 更新问题类型指示器
        function updateQuestionTypeIndicator(type) {
            const config = questionTypeConfig[type];
            questionTypeDisplay.textContent = config.name;
            questionTypeDisplay.className = `text-xl font-bold ${config.color}`;
            typeIcon.className = `fa ${config.icon} ${config.color} text-xl mr-2`;
            questionTypeIndicator.className = `bg-white rounded-xl shadow-lg p-3 w-[45%] flex items-center justify-center card-hover ${config.color.replace('text-', 'border-')} border-2`;
        }

        // 检查选项答案
        function checkAnswer(e) {
            if (!gameState.isPlaying) return;
            
            clearInterval(gameState.timerInterval);
            const selectedAnswer = e.target.textContent;
            
            // 禁用所有选项按钮
            optionButtons.forEach(button => {
                button.disabled = true;
                if (button.textContent === gameState.currentQuestion.answer) {
                    button.classList.remove(questionTypeConfig[gameState.currentQuestion.type].buttonColor);
                    button.classList.add('bg-secondary');
                } else if (button === e.target) {
                    button.classList.remove(questionTypeConfig[gameState.currentQuestion.type].buttonColor);
                    button.classList.add('bg-danger');
                } else {
                    button.classList.add('opacity-70');
                }
            });
            
            // 判断答案是否正确
            if (selectedAnswer === gameState.currentQuestion.answer) {
                handleCorrectAnswer();
            } else {
                handleWrongAnswer();
            }
        }

        // 检查输入答案
        function checkInputAnswer() {
            if (!gameState.isPlaying || !inputAnswer.value.trim()) return;
            
            clearInterval(gameState.timerInterval);
            const userAnswer = inputAnswer.value.trim().toLowerCase();
            
            // 判断答案是否正确（考虑一些常见的同义表达）
            if (userAnswer === gameState.currentQuestion.answer.toLowerCase() ||
                (gameState.currentQuestion.answer.includes("或") && 
                 gameState.currentQuestion.answer.toLowerCase().split("或").some(ans => userAnswer === ans.trim()))) {
                handleCorrectAnswer();
            } else {
                handleWrongAnswer();
            }
            
            // 禁用输入和提交按钮
            inputAnswer.disabled = true;
            submitAnswer.disabled = true;
        }

        // 处理正确答案
        function handleCorrectAnswer() {
            gameState.score += 10 + gameState.timeLeft; // 得分基于剩余时间
            gameState.correctAnswers++;
            updateScore();
            
            feedbackDisplay.textContent = "正确！";
            feedbackDisplay.className = "text-center h-10 mb-4 text-secondary font-bold fade-in";
            
            // 延迟生成下一题
            setTimeout(() => {
                inputAnswer.disabled = false;
                submitAnswer.disabled = false;
                generateQuestion();
                startTimer();
            }, 1000);
        }

        // 处理错误答案
        function handleWrongAnswer() {
            gameState.wrongAnswers++;
            feedbackDisplay.textContent = `错误！正确答案是: ${gameState.currentQuestion.answer}`;
            feedbackDisplay.className = "text-center h-10 mb-4 text-danger font-bold fade-in";
            
            // 如果错误次数达到3次，游戏结束
            if (gameState.wrongAnswers >= 3) {
                endGame();
            } else {
                // 延迟生成下一题
                setTimeout(() => {
                    inputAnswer.disabled = false;
                    submitAnswer.disabled = false;
                    generateQuestion();
                    startTimer();
                }, 2000);
            }
        }

        // 结束游戏
        function endGame() {
            gameState.isPlaying = false;
            clearInterval(gameState.timerInterval);
            
            // 保存分数
            const isPersonalBest = saveScore();
            
            // 更新游戏结束模态框
            finalScoreDisplay.textContent = gameState.score;
            correctAnswersDisplay.textContent = gameState.correctAnswers;
            wrongAnswersDisplay.textContent = gameState.wrongAnswers;
            
            // 显示高分提示
            if (isPersonalBest) {
                highscoreIndicator.classList.remove('hidden');
                highscoreMessage.textContent = `恭喜！新的个人最佳成绩: ${gameState.score}分`;
            } else {
                highscoreIndicator.classList.add('hidden');
            }
            
            // 显示游戏结束模态框
            gameOverModal.classList.remove('hidden');
            setTimeout(() => {
                gameOverContent.classList.remove('scale-95', 'opacity-0');
                gameOverContent.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            // 重置按钮状态
            startBtn.classList.remove('hidden');
            restartBtn.classList.add('hidden');
        }

        // 备用题库（当无法加载JSON文件时使用）
        function getFallbackQuestions() {
            return {
                math: [
                    {
                        question: "6 × 7 = ?",
                        answer: "42",
                        options: ["40", "42", "45"]
                    },
                    {
                        question: "18 ÷ 3 + 5 = ?",
                        answer: "11",
                        options: ["10", "11", "12"]
                    }
                ],
                logic: [
                    {
                        question: "一个人在漆黑的房间里能看到东西吗？",
                        answer: "不能",
                        options: ["能", "不能", "有时能"]
                    },
                    {
                        question: "什么东西越洗越脏？",
                        answer: "水",
                        options: ["水", "衣服", "肥皂"]
                    }
                ],
                trivia: [
                    {
                        question: "什么东西有五个头，但人不觉得它怪呢？",
                        answer: "手或脚",
                        options: ["手或脚", "怪物", "手套"]
                    },
                    {
                        question: "什么东西晚上才会长出尾巴？",
                        answer: "流星",
                        options: ["流星", "猫", "月亮"]
                    }
                ],
                word: [
                    {
                        question: "请找出与'巨大'意思相反的词",
                        answer: "微小",
                        options: ["微小", "高大", "广阔"]
                    },
                    {
                        question: "下列哪个词是'快乐'的近义词？",
                        answer: "高兴",
                        options: ["高兴", "悲伤", "愤怒"]
                    }
                ],
                life: [
                    {
                        question: "哪种食物富含维生素C？",
                        answer: "橙子",
                        options: ["橙子", "牛肉", "米饭"]
                    },
                    {
                        question: "火灾时应该拨打哪个电话？",
                        answer: "119",
                        options: ["119", "110", "120"]
                    }
                ],
                fun: [
                    {
                        question: "为什么自由女神像总是站在纽约港？",
                        answer: "因为她不能坐下",
                        options: [
                            "因为她不能坐下",
                            "那是她的工作岗位",
                            "为了方便游客参观"
                        ]
                    },
                    {
                        question: "什么东西人们在不停地吃它，却永远吃不饱？",
                        answer: "空气",
                        options: ["空气", "水", "零食"]
                    }
                ],
                number: [
                    {
                        question: "找出数列中的下一个数字：2, 4, 8, 16, ?",
                        answer: "32",
                        options: ["32", "24", "30"]
                    },
                    {
                        question: "找出数列中的下一个数字：1, 3, 6, 10, ?",
                        answer: "15",
                        options: ["12", "14", "15"]
                    }
                ]
            };
        }

        // 初始化游戏
        async function initGame() {
            initEventListeners();
            difficultyDisplay.textContent = gameState.difficulty.charAt(0).toUpperCase() + gameState.difficulty.slice(1);
            timerDisplay.textContent = gameState.timeLimit;
            
            // 加载玩家数据
            loadPlayerData();
            
            // 加载题库
            await loadQuestions();
        }

        // 页面加载完成后初始化游戏
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
